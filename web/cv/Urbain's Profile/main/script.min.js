var renderer=new THREE.WebGLRenderer({antialias:!0});function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}renderer.setSize(window.innerWidth,window.innerHeight),window.innerWidth>800&&(renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.shadowMap.needsUpdate=!0),document.body.appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1);var camera=new THREE.PerspectiveCamera(20,window.innerWidth/window.innerHeight,1,500);camera.position.set(0,2,14);var scene=new THREE.Scene,city=new THREE.Object3D,smoke=new THREE.Object3D,town=new THREE.Object3D,createCarPos=!0,uSpeed=.001;city.rotation.x=-.05,city.rotation.y=29.6,city.rotation.z=-7.42;var setcolor=16738877;function mathRandom(e=8){return-Math.random()*e+Math.random()*e}scene.background=new THREE.Color(setcolor),scene.fog=new THREE.Fog(setcolor,10,16);var setTintNum=!0;function setTintColor(){if(setTintNum){setTintNum=!1;var e=0}else{setTintNum=!0;e=0}return e}function init(){for(var e=1;e<100;e++){var t=new THREE.CubeGeometry(1,0,0,2,2,2),o=new THREE.MeshStandardMaterial({color:setTintColor(),wireframe:!1,metalness:1,shading:THREE.SmoothShading,side:THREE.DoubleSide}),n=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0,transparent:!0,opacity:.03,side:THREE.DoubleSide}),a=new THREE.Mesh(t,o),i=(new THREE.Mesh(t,n),new THREE.Mesh(t,o)),r=new THREE.Mesh(t,n);a.add(r),a.castShadow=!0,a.receiveShadow=!0,a.rotationValue=.1+Math.abs(mathRandom(8)),i.scale.y=.05,a.scale.y=.1+Math.abs(mathRandom(8)),a.setScale=.1+Math.abs(mathRandom()),TweenMax.to(a.scale,4,{y:a.setScale,ease:Elastic.easeInOut,delay:.2*e,yoyo:!0,repeat:-1}),TweenMax.to(a.position,4,{y:a.setScale/2,ease:Elastic.easeInOut,delay:.2*e,yoyo:!0,repeat:-1});a.scale.x=a.scale.z=.9+mathRandom(1-.9),a.position.x=Math.round(mathRandom()),a.position.z=Math.round(mathRandom()),i.position.set(a.position.x,0,a.position.z),town.add(i),town.add(a)}for(var s=new THREE.MeshToonMaterial({color:14509602,side:THREE.DoubleSide}),d=new THREE.CircleGeometry(.01,3),c=1;c<300;c++){var h=new THREE.Mesh(d,s);h.position.set(mathRandom(5),mathRandom(5),mathRandom(5)),h.rotation.set(mathRandom(),mathRandom(),mathRandom()),smoke.add(h)}var m=new THREE.MeshPhongMaterial({color:0,side:THREE.DoubleSide,roughness:10,metalness:.6,opacity:.9,transparent:!0}),w=new THREE.PlaneGeometry(60,60),E=new THREE.Mesh(w,m);E.rotation.x=-90*Math.PI/180,E.position.y=-.001,E.receiveShadow=!0,city.add(E)}var INTERSECTED,intersected,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;function onMouseMove(e){e.preventDefault(),mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1}function onDocumentTouchStart(e){1==e.touches.length&&(e.preventDefault(),mouse.x=e.touches[0].pageX-window.innerWidth/2,mouse.y=e.touches[0].pageY-window.innerHeight/2)}function onDocumentTouchMove(e){1==e.touches.length&&(e.preventDefault(),mouse.x=e.touches[0].pageX-window.innerWidth/2,mouse.y=e.touches[0].pageY-window.innerHeight/2)}window.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("touchstart",onDocumentTouchStart,!1),window.addEventListener("touchmove",onDocumentTouchMove,!1);var ambientLight=new THREE.AmbientLight(16777215,4),lightFront=new THREE.SpotLight(16777215,20,10),lightBack=new THREE.PointLight(16777215,.5),spotLightHelper=new THREE.SpotLightHelper(lightFront);lightFront.rotation.x=45*Math.PI/180,lightFront.rotation.z=-45*Math.PI/180,lightFront.position.set(5,5,5),lightFront.castShadow=!0,lightFront.shadow.mapSize.width=6e3,lightFront.shadow.mapSize.height=lightFront.shadow.mapSize.width,lightFront.penumbra=.1,lightBack.position.set(0,6,0),smoke.position.y=2,scene.add(ambientLight),city.add(lightFront),scene.add(lightBack),scene.add(city),city.add(smoke),city.add(town);var gridHelper=new THREE.GridHelper(60,120,16711680,0),generateCar=function(){},createCars=function(e=2,t=20,o=10332914){var n=new THREE.MeshToonMaterial({color:o,side:THREE.DoubleSide}),a=new THREE.CubeGeometry(1,e/40,e/40),i=new THREE.Mesh(a,n);createCarPos?(createCarPos=!1,i.position.x=-t,i.position.z=mathRandom(3),TweenMax.to(i.position,3,{x:t,repeat:-1,yoyo:!0,delay:mathRandom(3)})):(createCarPos=!0,i.position.x=mathRandom(3),i.position.z=-t,i.rotation.y=90*Math.PI/180,TweenMax.to(i.position,5,{z:t,repeat:-1,yoyo:!0,delay:mathRandom(3),ease:Power1.easeInOut})),i.receiveShadow=!1,i.castShadow=!0,i.position.y=Math.abs(mathRandom(5)),city.add(i)},generateLines=function(){for(var e=0;e<60;e++)createCars(.1,20)};function moveCamera(){const e=document.body.getBoundingClientRect().top;console.log(),city.rotation.y-=(8*e-camera.rotation.y)*uSpeed*.01,city.rotation.x-=(-2*e-camera.rotation.x)*uSpeed*.01,city.rotation.z-=(-2*e-camera.rotation.x)*uSpeed*.01,city.rotation.x<-.05?city.rotation.x=-.05:city.rotation.x>1&&(city.rotation.x=1);Math.sin(Date.now()/5e3)}document.body.onscroll=moveCamera;var cameraSet=function(){createCars(.1,20,10332914)},animate=function(){Date.now();requestAnimationFrame(animate);for(let e=0,t=town.children.length;e<t;e++)town.children[e];smoke.rotation.y+=.01,smoke.rotation.x+=.01,camera.lookAt(city.position),renderer.render(scene,camera)};generateLines(),init(),animate();